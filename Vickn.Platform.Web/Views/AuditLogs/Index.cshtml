@using Vickn.Platform.Users.Authorization
@model Vickn.PlatfForm.Utils.Pager.PagerResult<Vickn.Platform.Auditing.Dto.AuditLogListDto, Vickn.Platform.Auditing.Dto.GetAuditLogsInput>

@{
    ViewBag.Menu = L("AuditLog");
    ViewBag.SecMenu = L("AuditLog");
    ViewBag.createBtn = L("CreateAuditLog");
    ViewBag.editBtn = L("EditAuditLog");

    ViewBag.ActiveMenu = "AuditLogs"; //The menu item will be active for this page.

}
<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页<span class="c-gray en">&gt;</span> @ViewBag.Menu <span class="c-gray en">&gt;</span> @ViewBag.SecMenu <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新"><i class="Hui-iconfont">&#xe68f;</i></a></nav>
<div class="page-container">
    <div class="cl pd-5 bg-1 bk-gray mt-20">
        <span class="l">
            @if (IsGranted(UserAppPermissions.User_DeleteUser))
            {
                <a href="javascript:;" class="btn btn-danger radius btn-delAll " data-url="@Url.Action("BatchDelete")"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a>
            }
            @if (IsGranted(UserAppPermissions.User_CreateUser))
            {
                <a href="javascript:;" class="btn btn-primary radius btn-openWindow" data-url="@Url.Action("Create", new {  })" data-title="@ViewBag.createBtn">
                    <i class="Hui-iconfont">&#xe600;</i> @ViewBag.createBtn
                </a>
            }
        </span> <span class="r">共有数据：<strong>@Model.TotalCount</strong> 条</span>
    </div>



    <table class="table table-border table-bordered table-hover table-bg dataTable ">
        <thead>
        <tr class="text-c">
            <th width="25"><input type="checkbox"></th>
            <th>时间</th>
            <th>用户名</th>
            <th>服务</th>
            <th>操作</th>
        </tr>
        </thead>
    </table>
</div>
@section scripts{
    <script src="~/Content/H-ui.admin_v3.0/lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
    <script>
        $(function () {
            var $dataTable = $(".dataTable");
            var settings = {
                autoWidth: false, //禁用自动调整列宽
                ordering: false, //取消默认排序查询,否则复选框一列会出现小箭头
                serverSide: true, //启用服务器端分页
                deferRender: true,
                bLengthChange: false,
                searching: false,
                "retrieve": true,//保证只有一个table实例
                ajax: function (data, callback, settings) {
                    var _service = abp.services.app.auditLog;
                    var input = {
                        pageIndex: parseInt(data.start / data.length) + 1,
                        maxResultCount: data.length,
                    };
                    _service.getAuditLogs(input).done(function (result) {
                        var returnData = {};
                        returnData.draw = data.draw; //这里直接自行返回了draw计数器,应该由后台返回
                        returnData.recordsTotal = result.totalCount;
                        returnData.recordsFiltered = result.totalCount; //后台不实现过滤功能，每次查询均视作全部结果
                        returnData.data = result.items;
                        callback(returnData);
                    });
                },
                "columns": [
                    {
                        "data": null
                    },
                    { "data": "impersonatorTenantId" },
                    { "data": "serviceName" },
                    { "data": "parameters" },
                    { "data": null }
                ],
                columnDefs: [
                    {
                        //   指定第一列，从0开始，0表示第一列，1表示第二列……
                        targets: 0,
                        render: function (data, type, row, meta) {
                            return '<input type="checkbox" name="check-box" class="check-box" value="' + row.id + '" />';
                        }
                    }, {
                        targets: 4,
                        render: function (date, type, row, meta) {
                            return ' <a title="编辑" href="javascript:;" class="ml-5 btn-openWindow" data-title="@ViewBag.editBtn" data-url="" style="text-decoration: none"><i class="Hui-iconfont">&#xe6df;</i></a>'
                        }
                    }
                ],
                buttons: [
        'copy', 'excel', 'pdf'
                ]
            };
            $dataTable.dataTable(settings);

        });
    </script>
}
